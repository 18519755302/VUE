<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自定义指令 手写slice指令</title>
    <script src="../vue.js"></script>
</head>

<body>
    <div id="app">
        <!-- <input type="text" v-focus:3.number='test' v-if='is' /> -->
        <input type="text" v-slice-jianxie:[num].number="content" />
    </div>
    <script>
        //当只有bind和update钩子函数时，可简写成这样
        Vue.directive('slice-jianxie',
            (el, binding, vnode) => {
                let vm = vnode.context;
                let {
                    value, //value 绑定值
                    arg, //arg 参数 5
                    expression, //expression为content 绑定字符串
                    modifiers // modifiers为{number:true}
                } = binding;
                if (modifiers.number) {
                    //通过value 向输入框和vm数据传值
                    value = value.replace(/[^0-9]/g, '');
                }
                arg = arg || 5;
                let realValue = value.slice(0, arg);
                //将值赋给输入框
                el.value = realValue;
                //将值赋给vm
                vm[expression] = realValue;
                el.oninput = function () {
                    let {
                        value
                    } = el;
                    if (modifiers.number) {
                        //通过value 向输入框和vm数据传值
                        value = value.replace(/[^0-9]/g, '');
                    }
                    let realValue = value.slice(0, arg);
                    //将值赋给输入框
                    el.value = realValue;
                    //将值赋给vm
                    vm[expression] = realValue;
                }
            }
        )

        //slice指令 未简写
        Vue.directive('slice', {
            bind(el, binding, vnode) {
                let vm = vnode.context;
                let {
                    value, //value 绑定值
                    arg, //arg 参数 5
                    expression, //expression为content 绑定字符串
                    modifiers // modifiers为{number:true}
                } = binding;
                if (modifiers.number) {
                    //通过value 向输入框和vm数据传值
                    value = value.replace(/[^0-9]/g, '');
                }
                arg = arg || 5;
                let realValue = value.slice(0, arg);
                //将值赋给输入框
                el.value = realValue;
                //将值赋给vm
                vm[expression] = realValue;
                el.oninput = function () {
                    let {
                        value
                    } = el;
                    if (modifiers.number) {
                        //通过value 向输入框和vm数据传值
                        value = value.replace(/[^0-9]/g, '');
                    }
                    let realValue = value.slice(0, arg);
                    //将值赋给输入框
                    el.value = realValue;
                    //将值赋给vm
                    vm[expression] = realValue;
                }
            },
            update(el, binding, vnode) {
                let vm = vnode.context;
                let {
                    value, //value 绑定值
                    arg, //arg 参数 5
                    expression, //expression为content 绑定字符串
                    modifiers // modifiers为{number:true}
                } = binding;
                if (modifiers.number) {
                    //通过value 向输入框和vm数据传值
                    value = value.replace(/[^0-9]/g, '');
                }
                arg = arg || 5;
                let realValue = value.slice(0, arg);
                //将值赋给输入框
                el.value = realValue;
                //将值赋给vm
                vm[expression] = realValue;
                el.oninput = function () {
                    let {
                        value
                    } = el;
                    if (modifiers.number) {
                        //通过value 向输入框和vm数据传值
                        value = value.replace(/[^0-9]/g, '');
                    }
                    let realValue = value.slice(0, arg);
                    //将值赋给输入框
                    el.value = realValue;
                    //将值赋给vm
                    vm[expression] = realValue;
                    //console.log(vm[expression]);
                }
            }

        })

        //binding中arg(参数)为3 modifiers(修饰符)为.number
        Vue.directive('focus', {
            //只调用一次，指令第一次绑定到元素时调用。在这里可以进行一次性的初始化设置。
            bind(el, binding) {
                console.log('bind', el, binding);
            },
            //被绑定元素插入父节点时调用
            inserted(el, binding) {
                console.log('insert', el, binding);
            },
            //所在组件的 VNode 更新时(页面更新时)调用，但是可能发生在其子 VNode 更新之前。
            update(el, binding, vnode, oldVnode) {
                console.log('update', el, binding, vnode, oldVnode);
            },
            //所在组件的 VNode 更新时(页面更新时)调用，发生在其子 VNode 更新之后。
            componentUpdated(el, binding, vnode, oldVnode) {
                console.log('componentUpdated', el, binding, vnode, oldVnode);
            },
            //只调用一次，指令与元素解绑时调用(被绑定的Dom元素被Vue移除)
            //可用v-if尝试
            unbind(el, binding, vnode) {
                console.log('unbind', el, binding, vnode);
            }
        })

        const vm = new Vue({
            el: "#app",
            data: {
                test: '123',
                //测试钩子方法unbind
                is: true,
                //与自定义指令slice绑定
                content: 'abc1234',
                //slice参数
                num: 2
            }
        })
    </script>
</body>

</html>