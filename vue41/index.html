<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>组件_通信实例</title>
    <script src="../vue.js"></script>
</head>

<body>
    <div id="app">
        <!-- props 父组件传递数据给子组件 推荐 -->
        <!-- <prop-cmp :ceshi="father"></prop-cmp> -->
        <!-- $emit 子组件传递数据给父组件 推荐 -->
        <!-- <emit-cmp @ent="myEvent"></emit-cmp> -->
        <!-- v-model 一般用于input -->
        <!-- <model-cmp v-model="ztext"></model-cmp> -->
        <!-- .sync -->
        <!-- <sync-cmp :value.sync="stext"></sync-cmp> -->
        <!-- $attrs 祖先组件传递数据给子孙组件 不推荐 -->
        <!-- <attrs-cmp label="label" :inputvalue="fuvalue"></attrs-cmp> -->
        <!-- $listeners 不推荐 可以在子孙组件中执行祖先组件的函数，从而实现数据传递。-->
        <!-- <listeners-cmp @focus="onfocus" @blur="onblur"></listeners-cmp> -->
        <!-- $root 不推荐 -->
        <!-- <root-cmp></root-cmp> -->
        <!-- $parent 不推荐 -->
        <!-- <parent-cmp></parent-cmp> -->
        <!-- $children 不推荐 -->
        <!-- <children-cmp></children-cmp> -->
        <!-- ref 可以在父组件中访问**子**实例的数据 不推荐-->
        <!-- <ref-cmp ref="refCmp"></ref-cmp> -->
        <!-- provide & inject 不推荐 -->
        <!-- <pi-cmp>
            <zpi-cmp></zpi-cmp>
        </pi-cmp> -->
        <!-- eventBus(事件总线) 不推荐 -->
        <jj-cmp></jj-cmp>
        <mm-cmp></mm-cmp>
    </div>
    <script>
        //使用 eventBus(事件总线) 兄弟组件中传输数据
        Vue.prototype.$bus = new Vue();
        Vue.component('jj-cmp', {
            data() {
                return {
                    a: '姐姐数据'
                }
            },
            template: `
                <button @click="onClick">测试eventBus(事件总线)</button>
            `,
            methods: {
                onClick() {
                    //console.log(this.a);
                    //提供数据
                    this.$bus.$emit('bus', this.a);
                }
            }
        })
        Vue.component('mm-cmp', {
            data() {
                return {
                    mm: ''
                }
            },
            template: `<div>{{mm}}</div>`,
            mounted() {
                this.$bus.$on('bus', data => {
                    //接收使用数据
                    console.log(data);
                    this.mm = data;
                })
            }
        })
        //props 父组件传递数据给子组件 推荐
        Vue.component('prop-cmp', {
            props: ['ceshi'],
            template: `
                <div>测试prop{{ceshi}}</div>
            `
        })
        //$emit 子组件传递数据给父组件 推荐
        Vue.component('emit-cmp', {
            template: `
                <button @click="$emit('ent','emit')">emit</button>
            `
        })
        //v-model 一般用于input 
        Vue.component('model-cmp', {
            props: ['value'],
            template: `
                <input :value="value" @input="$emit('input',$event.target.value)" />
            `
        })
        //sync 一般用于input
        Vue.component('sync-cmp', {
            props: ['value'],
            template: `
                <input :value='value' @input="$emit('update:value',$event.target.value)" />
            `
        })
        //attrs 祖先组件传递数据给子孙组件
        Vue.component('attrs-cmp', {
            //``inheritAttrs: false`` 和 ``$attrs`` 相互配合
            inheritAttrs: false,
            props: ['label', 'value'],
            mounted() {
                console.log(this.$attrs);
            },
            template: `
                <label>
                    {{ label }}
                    <input
                        v-bind:value="$attrs['inputvalue']"
                        v-on:input="$emit('input', $event.target.value)"
                    >
                </label>
            `,
        })
        //$listeners 
        Vue.component('listeners-cmp', {
            mounted() {
                console.log(this.$listeners);
            },
            template: `
                <label><input v-on="$listeners" /></label>
            `
        })
        //$root 不推荐
        Vue.component('root-cmp', {
            created() {
                console.log(this.$root.name);
            },
            template: `<div>测试root</div>`
        })
        //$parent 不推荐
        Vue.component('parent-cmp', {
            mounted() {
                console.log(this.$parent.parentname);
            },
            template: `<div>测试parent</div>`
        })
        //$children 
        Vue.component('children-cmp', {
            data() {
                return {
                    name: '我是子数据'
                }
            },
            template: `
             <div>测试children</div>
            `
        })
        //ref
        Vue.component('ref-cmp', {
            template: `
                <div>测试ref</div>
            `
        })
        //provide && inject
        Vue.component('pi-cmp', {
            template: `
                <div>测试provide和inject<slot></slot></div>
            `,
            provide() {
                return {
                    share: '数据'
                }
            }
        })
        Vue.component('zpi-cmp', {
            template: `<div></div>`,
            inject: ['share'],
            mounted() {
                console.log(this.share);
            }
        })
        const vm = new Vue({
            el: '#app',
            methods: {
                //测试$emit
                myEvent(child) {
                    console.log(child);
                },
                //测试 $listeners
                onfocus() {
                    console.log('focus');
                },
                onblur() {
                    console.log('blur');
                }
            },
            data() {
                return {
                    share: '我是provide的数据'
                }
            },
            data: {
                //$parent
                parentname: '测试$parent',
                //$root
                name: '测试$root',
                //$attrs
                fuvalue: '测试attrs',
                //sync
                stext: '',
                //v-model
                ztext: ''
                //father: '父组件'
            },

            created() {
                //console.log(this.$root.name);
            },
            mounted() {
                //获取$refs.refCmp
                console.log(this.$refs.refCmp);
                //获取$children 
                console.log(this.$children[0].name);
            }
        });
    </script>
</body>

</html>